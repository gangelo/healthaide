<%= turbo_frame_tag "modal" do %>
  <div class="relative z-10" data-controller="modal" data-action="click@window->modal#clickOutside" data-modal-item-type-value="health condition">
    <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"></div>

    <div class="fixed inset-0 z-10 overflow-y-auto">
      <div class="flex min-h-full items-center justify-center p-4 text-center">
        <div class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all w-[600px] max-w-full">
          <div class="bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4" style="min-height: 500px;">
            <div class="absolute right-0 top-0 pr-4 pt-4">
              <%= link_to user_health_conditions_path,
                  class: "text-gray-400 hover:text-gray-500",
                  data: { turbo_frame: "modal" } do %>
                <span class="sr-only">Close</span>
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
              <% end %>
            </div>

            <div class="sm:flex sm:items-start">
              <div class="w-full">
                <h3 class="text-lg font-semibold leading-6 text-gray-900 mb-4">Select Health Conditions</h3>

                <%= form_with(url: add_multiple_user_health_conditions_path, method: :post, data: { turbo: true }) do |form| %>
                  <div data-controller="health-condition-search-form">
                    <div class="relative mb-4">
                      <%= text_field_tag :search, params[:search],
                          class: "w-full px-3 py-2 pl-3 pr-10 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",
                          placeholder: "Search health conditions...",
                          autocomplete: "off",
                          data: {
                            health_condition_search_form_target: "input",
                            action: "input->health-condition-search-form#search"
                          } %>
                      <% if params[:search].present? %>
                        <button type="button"
                                class="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-gray-600"
                                data-action="click->health-condition-search-form#clear">
                          <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                          </svg>
                        </button>
                      <% end %>
                    </div>

                    <div data-health-condition-search-form-target="container">
                      <%= render "conditions_list_frame", health_conditions: @health_conditions %>
                    </div>
                  </div>

                  <div class="my-4 flex flex-col sm:flex-row sm:items-center gap-2">
                    <div class="flex gap-3 order-2 sm:order-1">
                      <button type="button"
                          class="text-sm text-blue-600 hover:text-blue-800"
                          data-action="click->modal#selectAll"
                          data-modal-target="selectAllButton">
                        Select All
                      </button>
                      <span class="text-sm text-gray-400">|</span>
                      <button type="button"
                          class="text-sm text-blue-600 hover:text-blue-800 opacity-50 cursor-not-allowed"
                          data-action="click->modal#selectNone"
                          data-modal-target="selectNoneButton"
                          disabled>
                        Select None
                      </button>
                    </div>
                    <span data-modal-target="selectionCount" class="text-sm text-gray-500 ml-auto order-1 sm:order-2">
                      0 health conditions selected
                    </span>
                  </div>

                  <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
                    <%= form.submit "Add Selected Health Conditions",
                        class: "inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm sm:ml-3 sm:w-auto opacity-50 cursor-not-allowed disabled:bg-blue-300",
                        data: { modal_target: "submitButton" },
                        disabled: true %>
                    <%= link_to "Cancel",
                        user_health_conditions_path,
                        class: "mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",
                        data: { turbo_frame: "modal" } %>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>
